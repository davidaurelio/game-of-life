'use strict';(function(){var r,p,m,s,t;r=function(){return function(e,g){function c(a){return function(){var b=a.apply(this,arguments);e.persist(f);return b}}function b(){d.domBoard.toggleCells(f.livingCells);f.reset()}function a(a){f.boardSize=a;d.domBoard.resizeTo(f)}function n(){var a=f.progress();d.domBoard.toggleCells(a)}function h(a){var b,c=d.domBoard;f&&(b=f.livingCells.symmetricDifference(a.livingCells),c.toggleCells(b));c.resizeTo(a);d.setBoardSize(a.boardSize);f=a}var f,d,k={playing:!1,
intervalLength:0,timeout:void 0,step:function(){c(n)();k.playing&&(k.timeout=setTimeout(k.step,k.intervalLength))}};d=g({clear:c(b),randomize:c(function(a){b();for(var c=Math.random,n=f.boardSize,h=f.livingCells,e=0;e<n;e++)for(var g=0;g<n;g++)1<=c()+a&&h.add([e,g]);d.domBoard.toggleCells(h)}),changeSize:a,commitChangedSize:c(function(b){a(b);f.cleanup()}),progress:c(n),toggleAutoplay:function(a,b){k.playing=a;k.intervalLength=b;k.step()},changeAutoplayInterval:function(a){k.intervalLength=a},toggleCell:c(function(a,
b){f.livingCells.toggle([a,b]);d.domBoard.toggleCell(a,b)})});k.intervalLength=d.autoplayIntervalLength;e.boardSize=d.boardSize;e.onGameState=h;h(e.restore())}}();p=function(){function e(c){return function(){return!c.apply(this,arguments)}}function g(c){this._map=Object.create(null);this._sequence=[];for(var b=c&&c.length||0,a=0;a<b;a++)this.add(c[a])}g.prototype={add:function(c){this.has(c)||(this._map[c]=1,this._sequence.push(String(c)))},has:function(c){return c in this._map},remove:function(c){if(this.has(c)){var b=
this._sequence;b.splice(b.indexOf(String(c)),1);delete this._map[c]}},toggle:function(c){this.has(c)?this.remove(c):this.add(c)},items:function(){return this._sequence.slice()},difference:function(c){return new g(this._sequence.filter(e(c.has),c))},union:function(c){return new g(this._sequence.concat(c._sequence))},symmetricDifference:function(c){return this.difference(c).union(c.difference(this))},map:function(c,b){return this._sequence.map(c,b)},join:function(c){return this._sequence.join(c)}};
return g}();m=function(){function e(e){return e.split(",").map(Number)}return{fromString:e,fromSet:function(g){return g.map(e)}}}();s=function(e,g){function c(a,b){b%=a;return 0>b?b+a:b}function b(a,b){this.boardSize=a;this.livingCells=b||new e}b.prototype={cleanup:function(){var a=this.boardSize,b=this.livingCells;g.fromSet(b).filter(function(b){return b[0]>=a||b[0]>=a}).forEach(b.remove,b)},progress:function(){for(var a=this.boardSize,b=this.livingCells,c=new e,f=0;f<a;f++)for(var d=0;d<a;d++){var g=
[f,d],l=this.numNeighbours(f,d);(3===l||2===l&&b.has(g))&&c.add(g)}this.livingCells=c;return b.symmetricDifference(c)},normalize:function(a,b){var h=this.boardSize;return[c(h,a),c(h,b)]},numNeighbours:function(a,b){for(var c=0,f=this.livingCells,d=0;9>d;d++){var e=a+d%3-1,g=b+(d/3|0)-1;4!==d&&f.has(this.normalize(e,g))&&(c+=1)}return c},reset:function(){this.livingCells=new e}};return b}(p,m);t=function(e){function g(b){return function(a){return b.apply(this,a)}}function c(b){this._table=b;this._size=
0}c.prototype={resizeTo:function(b){var a=this._size,c=b.boardSize;c>a?this._grow(c,b.livingCells):c<a&&this._shrink(c)},_grow:function(b,a){var c,h,f,d,e=this._size,g=this._table;for(d=0;d<b;d++)for(f=(h=d>=e)?g.insertRow(d):g.rows[d],h=h?0:e;h<b;h++)c=f.insertCell(h),c.appendChild(document.createElement("span")),c=c.dataset.coordinates=[h,d],a.has(c)&&this.enableCell(h,d);this._size=b},_shrink:function(b){var a=this._size,c=this._table,e,f,d;for(f=0;f<b;f++)for(e=c.rows[f],d=a-1;d>=b;d--)e.deleteCell(d);
for(f=a-1;f>=b;f--)c.deleteRow(f);this._size=b},_getCell:function(b,a){return this._table.rows[a].cells[b]},enableCell:function(b,a){this._getCell(b,a).classList.add("alive")},toggleCell:function(b,a){this._getCell(b,a).classList.toggle("alive")},toggleCells:function(b){e.fromSet(b).forEach(g(this.toggleCell),this)}};return c}(m);p=function(e,g){var c={boardSize:{min:0,max:Infinity,standard:10},_restrictBoardSize:function(b){var a=this.boardSize;return b?b<a.min?a.min:b>a.max?a.max:b:a.standard},
restore:function(){var b=decodeURIComponent(location.hash.slice(1)).split(":"),a=this._restrictBoardSize(Number(b[0])),a=new e(a),c=a.livingCells;(b=String(b[1]).match(/\d+,\d+/g))&&b.forEach(c.add,c);return a},persist:function(b){var a=b.boardSize+":"+b.livingCells.join(","),a="#"+encodeURI(a);a!==location.hash&&history.pushState({boardSize:b.boardSize,livingCells:b.livingCells.items()},document.title,a)},onGameState:function(){}};window.onpopstate=function(b){var a=b.state,a=a?new e(a.boardSize,
new g(a.livingCells)):c.restore();c.onGameState(a);b.preventDefault()};return c}(s,p);m=function(e,g){function c(a){var c=a.value;a=document.querySelectorAll("output[for="+JSON.stringify(a.id)+"]");b.call(a,function(a){a.value=c})}var b=[].forEach;return function(a,n,h){var f=a.querySelector("#clear"),d=a.querySelector("#density"),k=a.querySelector("#randomize"),l=a.querySelector("#size"),m=a.querySelector("#step"),p=a.querySelector("#autoplay"),q=a.querySelector("#autoplay-speed");f.onclick=h.clear;
k.onclick=function(){h.randomize(Number(d.value))};l.oninput=function(){h.changeSize(Number(this.value))};l.onchange=function(){h.commitChangedSize(Number(this.value))};m.onclick=h.progress;p.onchange=function(){h.toggleAutoplay(this.checked,Number(q.value))};q.oninput=function(){h.changeAutoplayInterval(Number(this.value))};n.onclick=function(){var a=event.target;"TD"!==a.nodeName&&(a=a.parentNode);if(a=a.dataset.coordinates)a=g.fromString(a),h.toggleCell(a[0],a[1])};b.call(a.querySelectorAll('input[type="range"][id]'),
c);a.oninput=function(a){a=a.target;"INPUT"===a.nodeName&&"range"===a.type&&c(a)};a.onsubmit=function(){return!1};return{autoplayIntervalLength:Number(q.value),boardSize:{standard:Number(l.value),min:Number(l.min),max:Number(l.max)},domBoard:new e(n),setBoardSize:function(a){l.value=a;c(l)}}}}(t,m);(function(e,g,c){e(g,function(b){return c(document.getElementById("controls"),document.getElementById("game-of-life"),b)})})(r,p,m)})();
